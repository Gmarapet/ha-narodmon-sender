# HA Narodmon Sender

Интеграция Home Assistant для агрегации данных с датчиков и отправки на Narodmon.ru (идентификация по MAC станции).

## Возможности
- Агрегация по группам (среднее/мин/макс) с выбором нескольких датчиков
- Сэмплинг каждые 10 секунд, усреднение по скользящему окну равному интервалу отправки
- Поддержка термометрии, влажности, давления, ветра, освещённости, ПМ, УФ и др.
- Произвольные датчики с пользовательским идентификатором
- Persistent notification при отсутствии данных в группе и автоматическое удаление при восстановлении
- Настройка MAC, LAT/LON/ALT и интервала отправки

## Установка вручную
1. Распакуй архив и скопируй папку `ha_narodmon_sender` в `/config/custom_components/`
2. Перезапусти Home Assistant
3. Добавь интеграцию: Настройки → Устройства и службы → Добавить интеграцию → HA Narodmon Sender

## Установка через HACS
1. Добавь репозиторий `https://github.com/Gmarapet/ha-narodmon-sender` в HACS → Custom repositories (category: Integration)
2. Установи интеграцию и перезапусти Home Assistant

## Конфигурация
- MAC (ID станции) — заполняется автоматически, но может быть изменён вручную
- Координаты: LAT, LON, ALT — по умолчанию берутся из Home Assistant
- Интервал отправки (секунды)
- Для каждой группы выбери один или несколько датчиков и метод агрегации (average/minimum/maximum)
- Добавляй произвольные датчики с пользовательским идентификатором при необходимости

## Пример JSON (отправляемого пакета)
```
{
  "ID": "AA:BB:CC:DD:EE:FF",
  "LAT": 55.7522,
  "LON": 37.6156,
  "ALT": 190,
  "TEMP": 22.3,
  "RH": 41,
  "PRESS": 1010.5,
  "WS": 3.2,
  "DIR": 270,
  "LUX": 860,
  "RAD": 0.11,
  "CO2": 415,
  "PM": 15,
  "DP": 14.5,
  "UPTIME": 48293,
  "BATCHARGE": 89
}
```

## Примечания
- Отправляются только числовые значения.
- Если все датчики группы недоступны, появляется уведомление в Home Assistant.
- При восстановлении датчика уведомление удаляется автоматически.
